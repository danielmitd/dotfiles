#compdef svnmerge

_svnmerge() {
    local state url
    typeset -A opt_args

    _arguments \
        '(-m)-m[branch to merge into trunk]:merge:->merge' \
        '(-r)-r[revision to start merge from]::' \
        && return 0

    case $state in
    merge)
        if [[ -d .svn ]]; then
            url=`svn info | grep 'Repository Root' | awk '{print $NF}'`
            svn list "$url/branches" | while IFS= read -r branch; do compadd ${branch%/}; done
        fi
    ;;
    esac
}

_svnmerge "$@"
