#compdef svnswitch

_svnswitch() {
    local curcontext="$curcontext" state line url
    typeset -A opt_args

    _arguments \
        '1: :->repo'

    case $state in
    repo)
        if [[ -d .svn ]]; then
            url=`svn info | grep 'Repository Root' | awk '{print $NF}'`
            svn list "$url/branches" | while IFS= read -r branch; do compadd ${branch%/}; done
            compadd "trunk"
        else
            _files
        fi
    ;;
    esac
}

_svnswitch "$@"